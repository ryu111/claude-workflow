# 進度視覺化規格

> 此文件定義 Ralph Loop 執行時的進度顯示格式。**必須**嚴格遵循這些格式。

---

## 🔒 強制規則

**每完成一個任務後，必須顯示進度報告。這不是可選的。**

---

## 運行中狀態

### 標準進度顯示

```
╔════════════════════════════════════════════════════════════════╗
║                    🔁 Loop 模式運行中                           ║
╚════════════════════════════════════════════════════════════════╝

📊 總體進度: X/Y 任務完成 (Z%)
[████████████░░░░░░░░░░░░░░] Z%

🔄 當前: [任務編號] [任務名稱]
   └── D→R→T: DEVELOPER ✅ → REVIEWER 🔄 → TESTER ⏳

📈 迭代: #N / 100
```

### OpenSpec 模式進度顯示

```
╔════════════════════════════════════════════════════════════════╗
║                    🔁 Loop 模式運行中（OpenSpec）               ║
╚════════════════════════════════════════════════════════════════╝

📁 Change: [change-id]
📊 總體進度: X/Y 任務完成 (Z%)
├── ✅ Phase 1: [Phase 名稱]  - 3/3 完成
├── 🔄 Phase 2: [Phase 名稱]  - 2/5 進行中
└── ⏳ Phase 3: [Phase 名稱]  - 0/4 待處理

🔄 當前: Task [編號] [任務名稱]
├── Agent: [agent 類型]
├── Files: [檔案列表]
└── D→R→T: DEVELOPER ✅ → REVIEWER 🔄 → TESTER ⏳

📈 迭代: #N / 100
```

---

## 進度條規格

### 格式

```
[████████████░░░░░░░░░░░░░░] Z%
```

### 生成規則

| 規則 | 說明 |
|------|------|
| 總寬度 | 26 字元 |
| 填滿字元 | `█`（已完成比例） |
| 空白字元 | `░`（剩餘比例） |
| 百分比 | 四捨五入到整數 |

### 計算公式

```
完成數 = tasks.md 中 `- [x]` 開頭的行數
總數 = tasks.md 中 `- [` 開頭的行數
百分比 = round(完成數 / 總數 * 100)
填滿字元數 = round(完成數 / 總數 * 26)
空白字元數 = 26 - 填滿字元數
```

### 範例

| 進度 | 顯示 |
|------|------|
| 0% | `[░░░░░░░░░░░░░░░░░░░░░░░░░░] 0%` |
| 25% | `[███████░░░░░░░░░░░░░░░░░░░] 25%` |
| 50% | `[█████████████░░░░░░░░░░░░░] 50%` |
| 75% | `[████████████████████░░░░░░] 75%` |
| 100% | `[██████████████████████████] 100%` |

---

## D→R→T 狀態圖示

### 狀態符號

| 狀態 | 符號 | 含義 |
|------|------|------|
| 完成 | ✅ | 該階段已通過 |
| 進行中 | 🔄 | 正在執行 |
| 待處理 | ⏳ | 尚未開始 |
| 失敗 | ❌ | 該階段失敗，需重試 |

### 顯示格式

```
D→R→T: DEVELOPER ✅ → REVIEWER 🔄 → TESTER ⏳
```

### 各種狀態範例

```
# 開發中
D→R→T: DEVELOPER 🔄 → REVIEWER ⏳ → TESTER ⏳

# 審查中
D→R→T: DEVELOPER ✅ → REVIEWER 🔄 → TESTER ⏳

# 測試中
D→R→T: DEVELOPER ✅ → REVIEWER ✅ → TESTER 🔄

# 全部完成
D→R→T: DEVELOPER ✅ → REVIEWER ✅ → TESTER ✅

# 審查失敗，返回開發
D→R→T: DEVELOPER 🔄 → REVIEWER ❌ → TESTER ⏳
```

---

## 完成狀態

### 所有任務完成

```
╔════════════════════════════════════════════════════════════════╗
║                    ✅ Loop 完成！                               ║
╚════════════════════════════════════════════════════════════════╝

📊 最終進度: Y/Y 任務完成 (100%)
[██████████████████████████] 100%

🎉 所有任務已完成！Loop 模式自動退出。
```

### OpenSpec 完成歸檔

```
╔════════════════════════════════════════════════════════════════╗
║                    ✅ OpenSpec 完成！                           ║
╚════════════════════════════════════════════════════════════════╝

📁 Change: [change-id]
📊 最終進度: Y/Y 任務完成 (100%)
[██████████████████████████] 100%

📦 已歸檔至: openspec/archive/[change-id]/

🎉 所有任務已完成！Loop 模式自動退出。
```

---

## 迭代計數

### 顯示格式

```
📈 迭代: #N / 100
```

### 規則

- 每次 Task 工具呼叫算 1 次迭代
- 達到 100 次迭代時觸發安全閥
- 用戶可選擇繼續或暫停

---

## 相關文件

- [safety-mechanisms.md](safety-mechanisms.md) - 安全閥機制
- [openspec-workflow.md](openspec-workflow.md) - OpenSpec 工作流
